<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - KuizTown</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #5F729F;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 192, 203, 0.08) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 192, 203, 0.08) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(255, 192, 203, 0.05) 0%, transparent 30%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Geometric Pattern Background */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(30deg, rgba(255, 192, 203, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(255, 192, 203, 0.05) 87.5%, rgba(255, 192, 203, 0.05)),
                linear-gradient(150deg, rgba(255, 192, 203, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(255, 192, 203, 0.05) 87.5%, rgba(255, 192, 203, 0.05)),
                linear-gradient(30deg, rgba(255, 192, 203, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(255, 192, 203, 0.05) 87.5%, rgba(255, 192, 203, 0.05)),
                linear-gradient(150deg, rgba(255, 192, 203, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(255, 192, 203, 0.05) 87.5%, rgba(255, 192, 203, 0.05)),
                linear-gradient(60deg, rgba(255, 192, 203, 0.08) 25%, transparent 25.5%, transparent 75%, rgba(255, 192, 203, 0.08) 75%, rgba(255, 192, 203, 0.08)),
                linear-gradient(60deg, rgba(255, 192, 203, 0.08) 25%, transparent 25.5%, transparent 75%, rgba(255, 192, 203, 0.08) 75%, rgba(255, 192, 203, 0.08));
            background-size: 80px 140px;
            background-position: 0 0, 0 0, 40px 70px, 40px 70px, 0 0, 40px 70px;
            opacity: 0.3;
            z-index: -1;
        }
        
        /* Container */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 15px 40px;
        }
        
        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 10px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 28px;
            background: linear-gradient(135deg, #9b59b6, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #87CEEB, #FFC0CB);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .skeleton-title {
            width: 120px;
            height: 20px;
            margin-bottom: 15px;
        }
        
        .skeleton-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .skeleton-stat {
            height: 80px;
            border-radius: 12px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: #87CEEB;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Tab Navigation */
        .tab-nav {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border: none;
            background: transparent;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #87CEEB, #5F729F);
            color: white;
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(135, 206, 235, 0.1);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .card-title {
            font-size: 1.1rem;
            color: #444;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: #87CEEB;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 50px 15px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.2);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .data-table th {
            background: linear-gradient(135deg, #87CEEB, #5F729F);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table tr:hover {
            background: rgba(135, 206, 235, 0.05);
        }
        
        /* Badge Styles */
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-success {
            background: rgba(144, 238, 144, 0.2);
            color: #2e8b57;
        }
        
        .badge-warning {
            background: rgba(255, 215, 0, 0.2);
            color: #b8860b;
        }
        
        .badge-danger {
            background: rgba(255, 99, 71, 0.2);
            color: #dc143c;
        }
        
        .badge-info {
            background: rgba(135, 206, 235, 0.2);
            color: #4682b4;
        }
        
        /* Button Actions */
        .btn-group {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .btn-view {
            background: rgba(135, 206, 235, 0.1);
            color: #4682b4;
        }
        
        .btn-edit {
            background: rgba(255, 215, 0, 0.1);
            color: #b8860b;
        }
        
        .btn-delete {
            background: rgba(255, 99, 71, 0.1);
            color: #dc143c;
        }
        
        .btn-approve {
            background: rgba(144, 238, 144, 0.1);
            color: #2e8b57;
        }
        
        .btn-reject {
            background: rgba(255, 99, 71, 0.1);
            color: #dc143c;
        }
        
        .btn-sm:hover {
            transform: translateY(-2px);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: border 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.2);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Reward Input Group */
        .reward-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: #333;
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn-primary {
            background: linear-gradient(135deg, #87CEEB, #5F729F);
            color: white;
        }
        
        .modal-btn-secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .modal-btn-danger {
            background: #ff6b6b;
            color: white;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Image Preview */
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        /* Maintenance Switch */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        
        input:checked + .slider {
            background-color: #87CEEB;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .slider.round {
            border-radius: 34px;
        }
        
        .slider.round:before {
            border-radius: 50%;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .page-btn.active {
            background: #87CEEB;
            color: white;
            border-color: #87CEEB;
        }
        
        .page-btn:hover:not(.active) {
            background: #f0f0f0;
        }
        
        /* Separator */
        .separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            margin: 20px 0;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }
        
        .empty-icon {
            font-size: 60px;
            color: rgba(135, 206, 235, 0.5);
            margin-bottom: 20px;
        }
        
        .empty-title {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .empty-desc {
            color: #999;
            max-width: 300px;
            margin: 0 auto;
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .tab-nav {
                flex-wrap: nowrap;
            }
        }
        
        @media (max-width: 767px) {
            .admin-info span {
                display: none;
            }
            
            .tab-btn {
                min-width: 100px;
                font-size: 0.9rem;
            }
            
            .reward-group {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .stat-value {
                font-size: 1.5rem;
            }
            
            .tab-btn {
                min-width: 80px;
                font-size: 0.8rem;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo-container">
                <i class="fas fa-shapes logo-icon"></i>
                <span class="logo-text">KuizTown Admin</span>
            </div>
            <div class="admin-info">
                <div class="admin-avatar" id="adminAvatar">A</div>
                <span id="adminName">Admin</span>
                <button onclick="logout()" style="background: none; border: none; color: white; cursor: pointer;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>
        
        <!-- Skeleton Loading -->
        <div id="skeletonLoading">
            <div class="skeleton-stats">
                <div class="skeleton skeleton-stat"></div>
                <div class="skeleton skeleton-stat"></div>
                <div class="skeleton skeleton-stat"></div>
                <div class="skeleton skeleton-stat"></div>
            </div>
            
            <div class="skeleton-card">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton" style="height: 40px; margin-bottom: 10px;"></div>
                <div class="skeleton" style="height: 200px; margin-bottom: 10px;"></div>
            </div>
        </div>
        
        <!-- Dashboard Content -->
        <div id="adminContent" style="display: none;">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total User</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="stat-value" id="totalGeo">0</div>
                    <div class="stat-label">Total GEO</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-value" id="pendingWithdraw">0</div>
                    <div class="stat-label">Pending Withdraw</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-value" id="pendingTasks">0</div>
                    <div class="stat-label">Pending Tugas</div>
                </div>
            </div>
            
            <div class="separator"></div>
            
            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="users">
                    <i class="fas fa-user-cog"></i> Manajemen User
                </button>
                <button class="tab-btn" data-tab="withdraw">
                    <i class="fas fa-wallet"></i> Pending Withdraw
                </button>
                <button class="tab-btn" data-tab="tasks">
                    <i class="fas fa-tasks"></i> Pending Tugas
                </button>
                <button class="tab-btn" data-tab="createTask">
                    <i class="fas fa-plus-circle"></i> Buat Tugas
                </button>
                <button class="tab-btn" data-tab="manageTask">
                    <i class="fas fa-edit"></i> Kelola Tugas
                </button>
                <button class="tab-btn" data-tab="maintenance">
                    <i class="fas fa-tools"></i> Maintenance
                </button>
            </div>
            
            <!-- Tab Contents -->
            
            <!-- Tab 1: Manajemen User -->
            <div id="usersTab" class="tab-content active">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-search"></i> Cari User
                    </h2>
                    <div class="search-container">
                        <input type="text" class="search-input" id="searchUser" 
                               placeholder="Cari berdasarkan username, email, atau UID...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>GEO</th>
                                    <th>LIFE</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="empty-state" id="noUsersFound" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <h3 class="empty-title">Tidak Ada User</h3>
                        <p class="empty-desc">Tidak ada user yang ditemukan.</p>
                    </div>
                </div>
            </div>
            
            <!-- Tab 2: Pending Withdraw -->
            <div id="withdrawTab" class="tab-content">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-clock"></i> Pending Withdraw
                    </h2>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Jumlah</th>
                                    <th>Metode</th>
                                    <th>Tanggal</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawTableBody">
                                <!-- Withdraw requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="empty-state" id="noWithdrawPending" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 class="empty-title">Tidak Ada Pending Withdraw</h3>
                        <p class="empty-desc">Semua permintaan withdraw telah diproses.</p>
                    </div>
                </div>
            </div>
            
            <!-- Tab 3: Pending Tugas -->
            <div id="tasksTab" class="tab-content">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-tasks"></i> Pending Tugas
                    </h2>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Tugas</th>
                                    <th>Tanggal</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="taskSubmissionsBody">
                                <!-- Task submissions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="empty-state" id="noTasksPending" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 class="empty-title">Tidak Ada Pending Tugas</h3>
                        <p class="empty-desc">Semua tugas telah direview.</p>
                    </div>
                </div>
            </div>
            
            <!-- Tab 4: Buat Tugas -->
            <div id="createTaskTab" class="tab-content">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-plus-circle"></i> Buat Tugas Baru
                    </h2>
                    
                    <form id="createTaskForm">
                        <div class="form-group">
                            <label class="form-label">Judul Tugas</label>
                            <input type="text" class="form-control" id="taskTitle" 
                                   placeholder="Contoh: Follow Instagram KuizTown" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Deskripsi Tugas</label>
                            <textarea class="form-control" id="taskDescription" 
                                      placeholder="Deskripsi singkat tentang tugas" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Instruksi Pengerjaan</label>
                            <textarea class="form-control" id="taskInstructions" 
                                      placeholder="Instruksi lengkap untuk user" rows="5" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Link Tujuan (URL)</label>
                            <input type="url" class="form-control" id="taskLink" 
                                   placeholder="https://example.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Reward</label>
                            <div class="reward-group">
                                <div>
                                    <label class="form-label">GEO (format: 5,0)</label>
                                    <input type="text" class="form-control" id="taskGeoReward" 
                                           placeholder="0,0" inputmode="decimal">
                                </div>
                                <div>
                                    <label class="form-label">LIFE</label>
                                    <input type="number" class="form-control" id="taskLifeReward" 
                                           placeholder="0" min="0">
                                </div>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">
                                Isi salah satu atau keduanya. Minimal salah satu harus diisi.
                            </small>
                        </div>
                        
                        <button type="submit" class="modal-btn modal-btn-primary" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> PUBLIKASIKAN TUGAS
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Tab 5: Kelola Tugas -->
            <div id="manageTaskTab" class="tab-content">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-edit"></i> Kelola Tugas
                    </h2>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Judul</th>
                                    <th>Reward</th>
                                    <th>Status</th>
                                    <th>Tanggal</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="manageTasksBody">
                                <!-- Tasks to manage will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="empty-state" id="noTasksToManage" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <h3 class="empty-title">Belum Ada Tugas</h3>
                        <p class="empty-desc">Buat tugas baru di tab "Buat Tugas".</p>
                    </div>
                </div>
            </div>
            
            <!-- Tab 6: Maintenance -->
            <div id="maintenanceTab" class="tab-content">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-tools"></i> Mode Maintenance
                    </h2>
                    
                    <div class="switch-container">
                        <div>
                            <h3 style="margin: 0 0 5px 0;">Status Maintenance</h3>
                            <p style="color: #666; margin: 0;">Aktifkan untuk mengarahkan semua user ke halaman maintenance</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="maintenanceToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Pesan Maintenance (Opsional)</label>
                        <textarea class="form-control" id="maintenanceMessage" 
                                  placeholder="Pesan yang akan ditampilkan di halaman maintenance" rows="3"></textarea>
                    </div>
                    
                    <button onclick="saveMaintenanceSettings()" class="modal-btn modal-btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> SIMPAN PENGATURAN
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: User Detail -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail User</h3>
                <button class="close-modal" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body" id="userModalBody">
                Loading...
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('userModal')">Tutup</button>
                <button class="modal-btn modal-btn-danger" onclick="banUser()" id="banBtn">Ban User</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Withdraw Detail -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail Withdraw</h3>
                <button class="close-modal" onclick="closeModal('withdrawModal')">&times;</button>
            </div>
            <div class="modal-body" id="withdrawModalBody">
                Loading...
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('withdrawModal')">Tutup</button>
                <button class="modal-btn modal-btn-danger" onclick="rejectWithdraw()">REJECT</button>
                <button class="modal-btn modal-btn-primary" onclick="approveWithdraw()">APPROVE</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Task Submission Detail -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail Tugas</h3>
                <button class="close-modal" onclick="closeModal('taskModal')">&times;</button>
            </div>
            <div class="modal-body" id="taskModalBody">
                Loading...
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('taskModal')">Tutup</button>
                <button class="modal-btn modal-btn-danger" onclick="rejectTask()">REJECT</button>
                <button class="modal-btn modal-btn-primary" onclick="approveTask()">APPROVE</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Edit Task -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Tugas</h3>
                <button class="close-modal" onclick="closeModal('editTaskModal')">&times;</button>
            </div>
            <div class="modal-body" id="editTaskModalBody">
                Loading...
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('editTaskModal')">Batal</button>
                <button class="modal-btn modal-btn-primary" onclick="saveTaskEdit()">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ADMIN PANEL SYSTEM
        // ============================================
        
        let currentUserData = null;
        let selectedUserId = null;
        let selectedWithdrawId = null;
        let selectedTaskId = null;
        let selectedTaskSubmissionId = null;
        
        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', function() {
            // Load Firebase
            loadFirebase().then(() => {
                checkAdminAccess();
            });
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Load Firebase
        async function loadFirebase() {
            try {
                // Load Firebase SDK secara dinamis
                const firebaseScript = document.createElement('script');
                firebaseScript.type = 'module';
                firebaseScript.textContent = `
                    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
                    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
                    import { 
                        getFirestore, 
                        doc, 
                        getDoc, 
                        collection, 
                        getDocs,
                        query,
                        where,
                        addDoc,
                        updateDoc,
                        deleteDoc,
                        serverTimestamp 
                    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

                    const firebaseConfig = {
                        apiKey: "AIzaSyB9DCc6rCmeXl0O3CCLYe6zUmfByfRz428",
                        authDomain: "kuiztown.firebaseapp.com",
                        projectId: "kuiztown",
                        storageBucket: "kuiztown.firebasestorage.app",
                        messagingSenderId: "334081803913",
                        appId: "1:334081803913:web:84899b42961e12f538a858"
                    };

                    const app = initializeApp(firebaseConfig);
                    const auth = getAuth(app);
                    const db = getFirestore(app);
                    
                    window.firebaseApp = app;
                    window.firebaseAuth = auth;
                    window.firebaseOnAuthStateChanged = onAuthStateChanged;
                    window.firebaseSignOut = signOut;
                    window.firebaseDb = db;
                    window.firebaseDoc = doc;
                    window.firebaseGetDoc = getDoc;
                    window.firebaseCollection = collection;
                    window.firebaseGetDocs = getDocs;
                    window.firebaseQuery = query;
                    window.firebaseWhere = where;
                    window.firebaseAddDoc = addDoc;
                    window.firebaseUpdateDoc = updateDoc;
                    window.firebaseDeleteDoc = deleteDoc;
                    window.firebaseServerTimestamp = serverTimestamp;
                `;
                document.head.appendChild(firebaseScript);
                
                // Tunggu Firebase selesai load
                await new Promise(resolve => {
                    const checkFirebase = setInterval(() => {
                        if (window.firebaseAuth) {
                            clearInterval(checkFirebase);
                            resolve();
                        }
                    }, 100);
                });
                
            } catch (error) {
                console.error("Error loading Firebase:", error);
                alert("Gagal memuat Firebase. Silakan refresh halaman.");
            }
        }
        
        // Check admin access
        async function checkAdminAccess() {
            window.firebaseOnAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    // Check if user is admin
                    const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", user.uid));
                    
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        
                        if (userData.role !== 'admin') {
                            // Redirect non-admin users
                            window.location.href = 'dashboard.html';
                            return;
                        }
                        
                        // Admin user, load data
                        currentUserData = userData;
                        loadAdminData();
                        setupAdminUI(userData);
                        
                    } else {
                        window.location.href = 'login.html';
                    }
                } else {
                    window.location.href = 'login.html';
                }
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Search user
            document.getElementById('searchUser').addEventListener('input', debounce(searchUsers, 300));
            
            // Create task form
            document.getElementById('createTaskForm').addEventListener('submit', createTask);
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                const modals = ['userModal', 'withdrawModal', 'taskModal', 'editTaskModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (event.target === modal) {
                        closeModal(modalId);
                    }
                });
            });
        }
        
        // Setup admin UI
        function setupAdminUI(userData) {
            document.getElementById('adminName').textContent = userData.username || 'Admin';
            document.getElementById('adminAvatar').textContent = (userData.username || 'A').charAt(0).toUpperCase();
            
            // Hide skeleton, show content
            document.getElementById('skeletonLoading').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
        }
        
        // Load admin data
        async function loadAdminData() {
            try {
                // Load dashboard stats
                await loadDashboardStats();
                
                // Load initial data for active tab
                switchTab('users');
                
            } catch (error) {
                console.error("Error loading admin data:", error);
            }
        }
        
        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                // Total Users
                const usersSnapshot = await window.firebaseGetDocs(window.firebaseCollection(window.firebaseDb, "users"));
                document.getElementById('totalUsers').textContent = usersSnapshot.size;
                
                // Total GEO
                let totalGeo = 0;
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    totalGeo += userData.geoBalance || 0;
                });
                document.getElementById('totalGeo').textContent = totalGeo.toLocaleString('id-ID', {
                    minimumFractionDigits: 1,
                    maximumFractionDigits: 1
                });
                
                // Pending Withdraw
                const withdrawQuery = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "withdrawals"),
                    window.firebaseWhere("status", "==", "PENDING")
                );
                const withdrawSnapshot = await window.firebaseGetDocs(withdrawQuery);
                document.getElementById('pendingWithdraw').textContent = withdrawSnapshot.size;
                
                // Pending Tasks
                const tasksQuery = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "taskSubmissions"),
                    window.firebaseWhere("status", "==", "pending")
                );
                const tasksSnapshot = await window.firebaseGetDocs(tasksQuery);
                document.getElementById('pendingTasks').textContent = tasksSnapshot.size;
                
            } catch (error) {
                console.error("Error loading dashboard stats:", error);
            }
        }
        
        // Switch tab
        async function switchTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabId) {
                    btn.classList.add('active');
                }
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            // Load data for the tab
            switch(tabId) {
                case 'users':
                    await loadUsers();
                    break;
                case 'withdraw':
                    await loadPendingWithdraw();
                    break;
                case 'tasks':
                    await loadPendingTasks();
                    break;
                case 'manageTask':
                    await loadManageTasks();
                    break;
                case 'maintenance':
                    await loadMaintenanceSettings();
                    break;
            }
        }
        
        // Load users
        async function loadUsers(searchTerm = '') {
            try {
                const usersSnapshot = await window.firebaseGetDocs(window.firebaseCollection(window.firebaseDb, "users"));
                const tbody = document.getElementById('usersTableBody');
                const noUsers = document.getElementById('noUsersFound');
                
                tbody.innerHTML = '';
                
                let users = [];
                usersSnapshot.forEach(doc => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                // Filter by search term
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    users = users.filter(user => 
                        (user.username && user.username.toLowerCase().includes(searchLower)) ||
                        (user.email && user.email.toLowerCase().includes(searchLower)) ||
                        (user.uid && user.uid.toLowerCase().includes(searchLower))
                    );
                }
                
                if (users.length === 0) {
                    noUsers.style.display = 'block';
                    return;
                }
                
                noUsers.style.display = 'none';
                
                // Display users
                users.forEach(user => {
                    const row = document.createElement('tr');
                    
                    // Status badge
                    let statusBadge = '<span class="badge badge-success">Active</span>';
                    if (user.status === 'banned') {
                        statusBadge = '<span class="badge badge-danger">Banned</span>';
                    }
                    
                    row.innerHTML = `
                        <td>${user.username || '-'}</td>
                        <td>${user.email || '-'}</td>
                        <td>${(user.geoBalance || 0).toLocaleString('id-ID', {minimumFractionDigits: 1, maximumFractionDigits: 1})}</td>
                        <td>${user.lifeBalance || 0}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn-sm btn-view" onclick="viewUserDetail('${user.id}')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn-sm btn-edit" onclick="editUserBalance('${user.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("Error loading users:", error);
            }
        }
        
        // Search users with debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function searchUsers(e) {
            loadUsers(e.target.value);
        }
        
        // Load pending withdraw
        async function loadPendingWithdraw() {
            try {
                const query = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "withdrawals"),
                    window.firebaseWhere("status", "==", "PENDING")
                );
                
                const snapshot = await window.firebaseGetDocs(query);
                const tbody = document.getElementById('withdrawTableBody');
                const noWithdraw = document.getElementById('noWithdrawPending');
                
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    noWithdraw.style.display = 'block';
                    return;
                }
                
                noWithdraw.style.display = 'none';
                
                snapshot.forEach(doc => {
                    const withdraw = { id: doc.id, ...doc.data() };
                    const row = document.createElement('tr');
                    
                    // Format date
                    let dateStr = "Tanggal tidak tersedia";
                    if (withdraw.createdAt) {
                        const date = withdraw.createdAt.toDate ? withdraw.createdAt.toDate() : new Date(withdraw.createdAt);
                        dateStr = date.toLocaleDateString('id-ID');
                    }
                    
                    row.innerHTML = `
                        <td>${withdraw.userEmail || 'Unknown'}</td>
                        <td>${withdraw.amount.toLocaleString('id-ID', {minimumFractionDigits: 1, maximumFractionDigits: 1})} GEO</td>
                        <td>${withdraw.method === 'bank' ? 'BANK' : 'E-WALLET'}</td>
                        <td>${dateStr}</td>
                        <td>
                            <button class="btn-sm btn-view" onclick="viewWithdrawDetail('${doc.id}')">
                                <i class="fas fa-eye"></i> Review
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("Error loading pending withdraw:", error);
            }
        }
        
        // Load pending tasks
        async function loadPendingTasks() {
            try {
                const query = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, "taskSubmissions"),
                    window.firebaseWhere("status", "==", "pending")
                );
                
                const snapshot = await window.firebaseGetDocs(query);
                const tbody = document.getElementById('taskSubmissionsBody');
                const noTasks = document.getElementById('noTasksPending');
                
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    noTasks.style.display = 'block';
                    return;
                }
                
                noTasks.style.display = 'none';
                
                // We need to get task titles from tasks collection
                const tasksSnapshot = await window.firebaseGetDocs(window.firebaseCollection(window.firebaseDb, "tasks"));
                const tasksMap = {};
                tasksSnapshot.forEach(doc => {
                    tasksMap[doc.id] = doc.data().title;
                });
                
                snapshot.forEach(doc => {
                    const submission = { id: doc.id, ...doc.data() };
                    const row = document.createElement('tr');
                    
                    // Format date
                    let dateStr = "Tanggal tidak tersedia";
                    if (submission.submittedAt) {
                        const date = submission.submittedAt.toDate ? submission.submittedAt.toDate() : new Date(submission.submittedAt);
                        dateStr = date.toLocaleDateString('id-ID');
                    }
                    
                    row.innerHTML = `
                        <td>${submission.userEmail || 'Unknown'}</td>
                        <td>${tasksMap[submission.taskId] || 'Unknown Task'}</td>
                        <td>${dateStr}</td>
                        <td><span class="badge badge-warning">PENDING</span></td>
                        <td>
                            <button class="btn-sm btn-view" onclick="viewTaskSubmission('${doc.id}')">
                                <i class="fas fa-eye"></i> Review
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("Error loading pending tasks:", error);
            }
        }
        
        // Load tasks for management
        async function loadManageTasks() {
            try {
                const snapshot = await window.firebaseGetDocs(window.firebaseCollection(window.firebaseDb, "tasks"));
                const tbody = document.getElementById('manageTasksBody');
                const noTasks = document.getElementById('noTasksToManage');
                
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    noTasks.style.display = 'block';
                    return;
                }
                
                noTasks.style.display = 'none';
                
                snapshot.forEach(doc => {
                    const task = { id: doc.id, ...doc.data() };
                    const row = document.createElement('tr');
                    
                    // Format rewards
                    let rewards = [];
                    if (task.geoReward > 0) {
                        rewards.push(`${task.geoReward} GEO`);
                    }
                    if (task.lifeReward > 0) {
                        rewards.push(`${task.lifeReward} LIFE`);
                    }
                    
                    // Status badge
                    let statusBadge = '<span class="badge badge-success">Active</span>';
                    if (task.status === 'paused') {
                        statusBadge = '<span class="badge badge-warning">Paused</span>';
                    } else if (task.status === 'inactive') {
                        statusBadge = '<span class="badge badge-danger">Inactive</span>';
                    }
                    
                    // Format date
                    let dateStr = "Tanggal tidak tersedia";
                    if (task.createdAt) {
                        const date = task.createdAt.toDate ? task.createdAt.toDate() : new Date(task.createdAt);
                        dateStr = date.toLocaleDateString('id-ID');
                    }
                    
                    row.innerHTML = `
                        <td>${task.title}</td>
                        <td>${rewards.join(' + ')}</td>
                        <td>${statusBadge}</td>
                        <td>${dateStr}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn-sm btn-edit" onclick="editTask('${doc.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-sm btn-delete" onclick="deleteTask('${doc.id}')">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error("Error loading tasks for management:", error);
            }
        }
        
        // Load maintenance settings
        async function loadMaintenanceSettings() {
            try {
                const settingsDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "settings", "maintenance"));
                
                if (settingsDoc.exists()) {
                    const settings = settingsDoc.data();
                    document.getElementById('maintenanceToggle').checked = settings.enabled || false;
                    document.getElementById('maintenanceMessage').value = settings.message || '';
                }
                
            } catch (error) {
                console.error("Error loading maintenance settings:", error);
            }
        }
        
        // Create new task
        async function createTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const instructions = document.getElementById('taskInstructions').value.trim();
            const link = document.getElementById('taskLink').value.trim();
            const geoReward = parseFloat(document.getElementById('taskGeoReward').value.replace(',', '.')) || 0;
            const lifeReward = parseInt(document.getElementById('taskLifeReward').value) || 0;
            
            // Validation
            if (!title || !description || !instructions || !link) {
                alert('Harap isi semua field yang wajib!');
                return;
            }
            
            if (geoReward === 0 && lifeReward === 0) {
                alert('Harap isi minimal satu reward (GEO atau LIFE)!');
                return;
            }
            
            try {
                const taskData = {
                    title: title,
                    description: description,
                    instructions: instructions,
                    link: link,
                    geoReward: geoReward,
                    lifeReward: lifeReward,
                    status: 'active',
                    createdAt: window.firebaseServerTimestamp(),
                    createdBy: currentUserData.username || 'Admin'
                };
                
                await window.firebaseAddDoc(window.firebaseCollection(window.firebaseDb, "tasks"), taskData);
                
                // Reset form
                document.getElementById('createTaskForm').reset();
                
                // Show success message
                alert('Tugas berhasil dibuat!');
                
                // Refresh tasks list
                await loadManageTasks();
                
            } catch (error) {
                console.error("Error creating task:", error);
                alert('Gagal membuat tugas. Silakan coba lagi.');
            }
        }
        
        // View user detail
        async function viewUserDetail(userId) {
            selectedUserId = userId;
            
            try {
                const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", userId));
                
                if (userDoc.exists()) {
                    const user = userDoc.data();
                    
                    // Get referral count
                    const referralQuery = window.firebaseQuery(
                        window.firebaseCollection(window.firebaseDb, "users"),
                        window.firebaseWhere("referredBy", "==", userId)
                    );
                    const referralSnapshot = await window.firebaseGetDocs(referralQuery);
                    
                    const modalBody = document.getElementById('userModalBody');
                    modalBody.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Informasi User</h4>
                            <p><strong>Username:</strong> ${user.username || '-'}</p>
                            <p><strong>Email:</strong> ${user.email || '-'}</p>
                            <p><strong>UID:</strong> ${userId}</p>
                            <p><strong>Tanggal Daftar:</strong> ${new Date(user.createdAt || Date.now()).toLocaleDateString('id-ID')}</p>
                            <p><strong>Status:</strong> ${user.status === 'banned' ? 'Banned' : 'Active'}</p>
                            <p><strong>Role:</strong> ${user.role || 'user'}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Saldo</h4>
                            <p><strong>GEO:</strong> ${(user.geoBalance || 0).toLocaleString('id-ID', {minimumFractionDigits: 1, maximumFractionDigits: 1})}</p>
                            <p><strong>LIFE:</strong> ${user.lifeBalance || 0}</p>
                            <p><strong>Total GEO Diperoleh:</strong> ${(user.totalEarnedGeo || 0).toLocaleString('id-ID', {minimumFractionDigits: 1, maximumFractionDigits: 1})}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Referral</h4>
                            <p><strong>Kode Referral:</strong> ${user.referralCode || '-'}</p>
                            <p><strong>Total Referral:</strong> ${referralSnapshot.size} user</p>
                            <p><strong>Diundang Oleh:</strong> ${user.referredBy || 'Tidak ada'}</p>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 10px;">Edit Saldo</h4>
                            <div class="form-group">
                                <label class="form-label">GEO</label>
                                <input type="number" class="form-control" id="editGeoBalance" 
                                       step="0.1" value="${user.geoBalance || 0}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">LIFE</label>
                                <input type="number" class="form-control" id="editLifeBalance" 
                                       value="${user.lifeBalance || 0}" min="0" max="10">
                            </div>
                        </div>
                    `;
                    
                    // Update ban button text
                    const banBtn = document.getElementById('banBtn');
                    banBtn.textContent = user.status === 'banned' ? 'Unban User' : 'Ban User';
                    
                    // Show modal
                    document.getElementById('userModal').style.display = 'flex';
                }
                
            } catch (error) {
                console.error("Error viewing user detail:", error);
            }
        }
        
        // View withdraw detail
        async function viewWithdrawDetail(withdrawId) {
            selectedWithdrawId = withdrawId;
            
            try {
                const withdrawDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "withdrawals", withdrawId));
                
                if (withdrawDoc.exists()) {
                    const withdraw = withdrawDoc.data();
                    
                    // Get user data
                    let userName = 'Unknown';
                    try {
                        const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", withdraw.userId));
                        if (userDoc.exists()) {
                            userName = userDoc.data().username || withdraw.userEmail;
                        }
                    } catch (e) {
                        console.error("Error getting user data:", e);
                    }
                    
                    // Format date
                    let dateStr = "Tanggal tidak tersedia";
                    if (withdraw.createdAt) {
                        const date = withdraw.createdAt.toDate ? withdraw.createdAt.toDate() : new Date(withdraw.createdAt);
                        dateStr = date.toLocaleString('id-ID');
                    }
                    
                    const modalBody = document.getElementById('withdrawModalBody');
                    modalBody.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Informasi User</h4>
                            <p><strong>Nama:</strong> ${userName}</p>
                            <p><strong>Email:</strong> ${withdraw.userEmail || '-'}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Detail Withdraw</h4>
                            <p><strong>Jumlah:</strong> ${withdraw.amount.toLocaleString('id-ID', {minimumFractionDigits: 1, maximumFractionDigits: 1})} GEO</p>
                            <p><strong>Konversi IDR:</strong> ${withdraw.idrAmount ? withdraw.idrAmount.toLocaleString('id-ID') + ' IDR' : 'Tidak tersedia'}</p>
                            <p><strong>Metode:</strong> ${withdraw.method === 'bank' ? 'BANK' : 'E-WALLET'}</p>
                            <p><strong>Detail:</strong> ${withdraw.methodDetail || '-'}</p>
                            <p><strong>Tanggal Permintaan:</strong> ${dateStr}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Informasi Rekening/Akun</h4>
                            <p><strong>Nama:</strong> ${withdraw.accountName || '-'}</p>
                            <p><strong>Nomor:</strong> ${withdraw.accountNumber || '-'}</p>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 10px;">Catatan dari User</h4>
                            <p style="background: #f5f5f5; padding: 10px; border-radius: 5px;">
                                ${withdraw.adminNote || 'Tidak ada catatan'}
                            </p>
                        </div>
                    `;
                    
                    // Show modal
                    document.getElementById('withdrawModal').style.display = 'flex';
                }
                
            } catch (error) {
                console.error("Error viewing withdraw detail:", error);
            }
        }
        
        // View task submission detail
        async function viewTaskSubmission(submissionId) {
            selectedTaskSubmissionId = submissionId;
            
            try {
                const submissionDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "taskSubmissions", submissionId));
                
                if (submissionDoc.exists()) {
                    const submission = submissionDoc.data();
                    
                    // Get task data
                    let taskTitle = 'Unknown Task';
                    let taskReward = 'Tidak ada reward';
                    try {
                        const taskDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "tasks", submission.taskId));
                        if (taskDoc.exists()) {
                            const task = taskDoc.data();
                            taskTitle = task.title;
                            
                            // Format rewards
                            let rewards = [];
                            if (task.geoReward > 0) {
                                rewards.push(`${task.geoReward} GEO`);
                            }
                            if (task.lifeReward > 0) {
                                rewards.push(`${task.lifeReward} LIFE`);
                            }
                            taskReward = rewards.join(' + ');
                        }
                    } catch (e) {
                        console.error("Error getting task data:", e);
                    }
                    
                    // Format date
                    let dateStr = "Tanggal tidak tersedia";
                    if (submission.submittedAt) {
                        const date = submission.submittedAt.toDate ? submission.submittedAt.toDate() : new Date(submission.submittedAt);
                        dateStr = date.toLocaleString('id-ID');
                    }
                    
                    const modalBody = document.getElementById('taskModalBody');
                    modalBody.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Informasi User</h4>
                            <p><strong>Email:</strong> ${submission.userEmail || 'Unknown'}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Detail Tugas</h4>
                            <p><strong>Judul Tugas:</strong> ${taskTitle}</p>
                            <p><strong>Reward:</strong> ${taskReward}</p>
                            <p><strong>Tanggal Submit:</strong> ${dateStr}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">Bukti Tugas</h4>
                            ${submission.proofUrl ? 
                                `<img src="${submission.proofUrl}" alt="Bukti Tugas" class="image-preview" onclick="window.open('${submission.proofUrl}', '_blank')" style="cursor: pointer;">
                                 <button class="btn-sm btn-view" onclick="window.open('${submission.proofUrl}', '_blank')" style="margin-top: 10px;">
                                     <i class="fas fa-external-link-alt"></i> Buka Gambar
                                 </button>` 
                                : '<p>Tidak ada bukti gambar</p>'}
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 10px;">Catatan dari User</h4>
                            <p style="background: #f5f5f5; padding: 10px; border-radius: 5px;">
                                ${submission.notes || 'Tidak ada catatan'}
                            </p>
                        </div>
                    `;
                    
                    // Show modal
                    document.getElementById('taskModal').style.display = 'flex';
                }
                
            } catch (error) {
                console.error("Error viewing task submission:", error);
            }
        }
        
        // Edit task
        async function editTask(taskId) {
            selectedTaskId = taskId;
            
            try {
                const taskDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "tasks", taskId));
                
                if (taskDoc.exists()) {
                    const task = taskDoc.data();
                    
                    const modalBody = document.getElementById('editTaskModalBody');
                    modalBody.innerHTML = `
                        <form id="editTaskForm">
                            <div class="form-group">
                                <label class="form-label">Judul Tugas</label>
                                <input type="text" class="form-control" id="editTaskTitle" 
                                       value="${task.title || ''}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Deskripsi Tugas</label>
                                <textarea class="form-control" id="editTaskDescription" 
                                          rows="3" required>${task.description || ''}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Instruksi Pengerjaan</label>
                                <textarea class="form-control" id="editTaskInstructions" 
                                          rows="5" required>${task.instructions || ''}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Link Tujuan (URL)</label>
                                <input type="url" class="form-control" id="editTaskLink" 
                                       value="${task.link || ''}" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Reward</label>
                                <div class="reward-group">
                                    <div>
                                        <label class="form-label">GEO (format: 5,0)</label>
                                        <input type="text" class="form-control" id="editTaskGeoReward" 
                                               value="${task.geoReward || 0}">
                                    </div>
                                    <div>
                                        <label class="form-label">LIFE</label>
                                        <input type="number" class="form-control" id="editTaskLifeReward" 
                                               value="${task.lifeReward || 0}" min="0">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-control" id="editTaskStatus">
                                    <option value="active" ${task.status === 'active' ? 'selected' : ''}>Active</option>
                                    <option value="paused" ${task.status === 'paused' ? 'selected' : ''}>Paused</option>
                                    <option value="inactive" ${task.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                </select>
                            </div>
                        </form>
                    `;
                    
                    // Show modal
                    document.getElementById('editTaskModal').style.display = 'flex';
                }
                
            } catch (error) {
                console.error("Error loading task for edit:", error);
            }
        }
        
        // Save task edit
        async function saveTaskEdit() {
            try {
                const title = document.getElementById('editTaskTitle').value.trim();
                const description = document.getElementById('editTaskDescription').value.trim();
                const instructions = document.getElementById('editTaskInstructions').value.trim();
                const link = document.getElementById('editTaskLink').value.trim();
                const geoReward = parseFloat(document.getElementById('editTaskGeoReward').value.replace(',', '.')) || 0;
                const lifeReward = parseInt(document.getElementById('editTaskLifeReward').value) || 0;
                const status = document.getElementById('editTaskStatus').value;
                
                // Validation
                if (!title || !description || !instructions || !link) {
                    alert('Harap isi semua field yang wajib!');
                    return;
                }
                
                if (geoReward === 0 && lifeReward === 0) {
                    alert('Harap isi minimal satu reward (GEO atau LIFE)!');
                    return;
                }
                
                const taskRef = window.firebaseDoc(window.firebaseDb, "tasks", selectedTaskId);
                await window.firebaseUpdateDoc(taskRef, {
                    title: title,
                    description: description,
                    instructions: instructions,
                    link: link,
                    geoReward: geoReward,
                    lifeReward: lifeReward,
                    status: status,
                    updatedAt: window.firebaseServerTimestamp()
                });
                
                // Close modal
                closeModal('editTaskModal');
                
                // Show success message
                alert('Tugas berhasil diperbarui!');
                
                // Refresh tasks list
                await loadManageTasks();
                
            } catch (error) {
                console.error("Error saving task edit:", error);
                alert('Gagal memperbarui tugas. Silakan coba lagi.');
            }
        }
        
        // Delete task
        async function deleteTask(taskId) {
            if (!confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {
                return;
            }
            
            try {
                await window.firebaseDeleteDoc(window.firebaseDoc(window.firebaseDb, "tasks", taskId));
                
                // Show success message
                alert('Tugas berhasil dihapus!');
                
                // Refresh tasks list
                await loadManageTasks();
                
            } catch (error) {
                console.error("Error deleting task:", error);
                alert('Gagal menghapus tugas. Silakan coba lagi.');
            }
        }
        
        // Ban/Unban user
        async function banUser() {
            try {
                const userRef = window.firebaseDoc(window.firebaseDb, "users", selectedUserId);
                const userDoc = await window.firebaseGetDoc(userRef);
                
                if (userDoc.exists()) {
                    const user = userDoc.data();
                    const newStatus = user.status === 'banned' ? 'active' : 'banned';
                    
                    await window.firebaseUpdateDoc(userRef, {
                        status: newStatus,
                        updatedAt: window.firebaseServerTimestamp()
                    });
                    
                    // Close modal
                    closeModal('userModal');
                    
                    // Show success message
                    alert(`User ${newStatus === 'banned' ? 'telah di-ban' : 'telah di-unban'}!`);
                    
                    // Refresh users list
                    await loadUsers();
                    
                }
            } catch (error) {
                console.error("Error banning user:", error);
                alert('Gagal mengubah status user. Silakan coba lagi.');
            }
        }
        
        // Edit user balance
        async function editUserBalance(userId) {
            selectedUserId = userId;
            
            try {
                const userDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "users", userId));
                
                if (userDoc.exists()) {
                    const user = userDoc.data();
                    
                    const newGeo = prompt(`Edit saldo GEO untuk ${user.username || 'user'} (current: ${user.geoBalance || 0}):`, user.geoBalance || 0);
                    const newLife = prompt(`Edit saldo LIFE untuk ${user.username || 'user'} (current: ${user.lifeBalance || 0}):`, user.lifeBalance || 0);
                    
                    if (newGeo !== null && newLife !== null) {
                        const geoBalance = parseFloat(newGeo.replace(',', '.')) || 0;
                        const lifeBalance = parseInt(newLife) || 0;
                        
                        if (lifeBalance < 0 || lifeBalance > 10) {
                            alert('LIFE harus antara 0 dan 10!');
                            return;
                        }
                        
                        const userRef = window.firebaseDoc(window.firebaseDb, "users", userId);
                        await window.firebaseUpdateDoc(userRef, {
                            geoBalance: geoBalance,
                            lifeBalance: lifeBalance,
                            updatedAt: window.firebaseServerTimestamp()
                        });
                        
                        // Show success message
                        alert('Saldo berhasil diperbarui!');
                        
                        // Refresh users list
                        await loadUsers();
                    }
                }
                
            } catch (error) {
                console.error("Error editing user balance:", error);
                alert('Gagal mengedit saldo. Silakan coba lagi.');
            }
        }
        
        // Approve withdraw
        async function approveWithdraw() {
            try {
                const withdrawRef = window.firebaseDoc(window.firebaseDb, "withdrawals", selectedWithdrawId);
                const withdrawDoc = await window.firebaseGetDoc(withdrawRef);
                
                if (withdrawDoc.exists()) {
                    const withdraw = withdrawDoc.data();
                    
                    // Update withdraw status
                    await window.firebaseUpdateDoc(withdrawRef, {
                        status: 'APPROVED',
                        approvedAt: window.firebaseServerTimestamp(),
                        approvedBy: currentUserData.username || 'Admin'
                    });
                    
                    // Close modal
                    closeModal('withdrawModal');
                    
                    // Show success message
                    alert('Withdraw telah disetujui!');
                    
                    // Refresh dashboard stats and withdraw list
                    await loadDashboardStats();
                    await loadPendingWithdraw();
                    
                }
            } catch (error) {
                console.error("Error approving withdraw:", error);
                alert('Gagal menyetujui withdraw. Silakan coba lagi.');
            }
        }
        
        // Reject withdraw
        async function rejectWithdraw() {
            try {
                const withdrawRef = window.firebaseDoc(window.firebaseDb, "withdrawals", selectedWithdrawId);
                const withdrawDoc = await window.firebaseGetDoc(withdrawRef);
                
                if (withdrawDoc.exists()) {
                    const withdraw = withdrawDoc.data();
                    
                    // Return GEO to user
                    const userRef = window.firebaseDoc(window.firebaseDb, "users", withdraw.userId);
                    const userDoc = await window.firebaseGetDoc(userRef);
                    
                    if (userDoc.exists()) {
                        const user = userDoc.data();
                        const newBalance = (user.geoBalance || 0) + withdraw.amount;
                        
                        await window.firebaseUpdateDoc(userRef, {
                            geoBalance: newBalance
                        });
                    }
                    
                    // Update withdraw status
                    await window.firebaseUpdateDoc(withdrawRef, {
                        status: 'REJECTED',
                        rejectedAt: window.firebaseServerTimestamp(),
                        rejectedBy: currentUserData.username || 'Admin'
                    });
                    
                    // Close modal
                    closeModal('withdrawModal');
                    
                    // Show success message
                    alert('Withdraw telah ditolak! Saldo GEO telah dikembalikan ke user.');
                    
                    // Refresh dashboard stats and withdraw list
                    await loadDashboardStats();
                    await loadPendingWithdraw();
                    
                }
            } catch (error) {
                console.error("Error rejecting withdraw:", error);
                alert('Gagal menolak withdraw. Silakan coba lagi.');
            }
        }
        
        // Approve task
        async function approveTask() {
            try {
                const submissionRef = window.firebaseDoc(window.firebaseDb, "taskSubmissions", selectedTaskSubmissionId);
                const submissionDoc = await window.firebaseGetDoc(submissionRef);
                
                if (submissionDoc.exists()) {
                    const submission = submissionDoc.data();
                    
                    // Get task data to know rewards
                    const taskDoc = await window.firebaseGetDoc(window.firebaseDoc(window.firebaseDb, "tasks", submission.taskId));
                    
                    if (taskDoc.exists()) {
                        const task = taskDoc.data();
                        
                        // Give rewards to user
                        const userRef = window.firebaseDoc(window.firebaseDb, "users", submission.userId);
                        const userDoc = await window.firebaseGetDoc(userRef);
                        
                        if (userDoc.exists()) {
                            const user = userDoc.data();
                            const updates = {};
                            
                            if (task.geoReward > 0) {
                                updates.geoBalance = (user.geoBalance || 0) + task.geoReward;
                                updates.totalEarnedGeo = (user.totalEarnedGeo || 0) + task.geoReward;
                            }
                            
                            if (task.lifeReward > 0) {
                                const newLife = (user.lifeBalance || 0) + task.lifeReward;
                                updates.lifeBalance = Math.min(newLife, 10); // Max 10 LIFE
                            }
                            
                            if (Object.keys(updates).length > 0) {
                                await window.firebaseUpdateDoc(userRef, updates);
                            }
                        }
                    }
                    
                    // Update submission status
                    await window.firebaseUpdateDoc(submissionRef, {
                        status: 'approved',
                        approvedAt: window.firebaseServerTimestamp(),
                        approvedBy: currentUserData.username || 'Admin'
                    });
                    
                    // Close modal
                    closeModal('taskModal');
                    
                    // Show success message
                    alert('Tugas telah disetujui! Reward telah diberikan ke user.');
                    
                    // Refresh dashboard stats and tasks list
                    await loadDashboardStats();
                    await loadPendingTasks();
                    
                }
            } catch (error) {
                console.error("Error approving task:", error);
                alert('Gagal menyetujui tugas. Silakan coba lagi.');
            }
        }
        
        // Reject task
        async function rejectTask() {
            try {
                const submissionRef = window.firebaseDoc(window.firebaseDb, "taskSubmissions", selectedTaskSubmissionId);
                
                // Update submission status
                await window.firebaseUpdateDoc(submissionRef, {
                    status: 'rejected',
                    rejectedAt: window.firebaseServerTimestamp(),
                    rejectedBy: currentUserData.username || 'Admin'
                });
                
                // Close modal
                closeModal('taskModal');
                
                // Show success message
                alert('Tugas telah ditolak!');
                
                // Refresh dashboard stats and tasks list
                await loadDashboardStats();
                await loadPendingTasks();
                
            } catch (error) {
                console.error("Error rejecting task:", error);
                alert('Gagal menolak tugas. Silakan coba lagi.');
            }
        }
        
        // Save maintenance settings
        async function saveMaintenanceSettings() {
            try {
                const enabled = document.getElementById('maintenanceToggle').checked;
                const message = document.getElementById('maintenanceMessage').value.trim();
                
                const settingsRef = window.firebaseDoc(window.firebaseDb, "settings", "maintenance");
                await window.firebaseSetDoc(settingsRef, {
                    enabled: enabled,
                    message: message,
                    updatedAt: window.firebaseServerTimestamp(),
                    updatedBy: currentUserData.username || 'Admin'
                }, { merge: true });
                
                // Show success message
                alert('Pengaturan maintenance telah disimpan!');
                
            } catch (error) {
                console.error("Error saving maintenance settings:", error);
                alert('Gagal menyimpan pengaturan. Silakan coba lagi.');
            }
        }
        
        // Logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                window.firebaseSignOut(window.firebaseAuth).then(() => {
                    window.location.href = 'login.html';
                }).catch(error => {
                    console.error("Error signing out:", error);
                });
            }
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
    </script>
</body>
</html>